{% extends 'default.html' %}

{% block title %}Web Tools{% endblock %}

{% block content %}
<style>
  #targetUrl {
    background-color: #323840;
    color: #fff;
    border: 1px solid #6c757d;
    margin-bottom: 1rem;
  }

  .container {
    height: 75vh;
  }


  .btn-primary {
    background-color: #495057;
    border-color: #495057;
  }

  /* Add hover effect for the primary button */
  .btn-primary:hover {
    background-color: #5e6770;
    border-color: #5e6770;
  }

  /* Style the secondary button */
  .btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
  }

  /* Add hover effect for the secondary button */
  .btn-secondary:hover {
    background-color: #7a8288;
    border-color: #7a8288;
  }
</style>
<div class="container d-flex justify-content-center align-items-center">
  <div class="row justify-content-center">
    <input type="text" id="targetUrl" class="form-control" placeholder="Enter target URL">
    <input type="text" id="scanId" class="form-control" placeholder="Enter scan Id">
    <!--buttons to start scans functions-->
    <button onclick="startSpider()" class="btn btn-primary">Start Spider Scan</button>
    <button onclick="startActiveScan()" class="btn btn-secondary">Start Active Scan</button>
    <button onclick="viewScanStatus()" class="btn btn-info">check scan status</button>
    <button onclick="generateXmlReport()">Generate XML Report</button>
    <button onclick="viewXmlReport()">View XML Report</button>
  </div>
</div>

<pre id="output"></pre>
<div id="scanStatusDisplay" class="alert alert-info" role="alert"></div>

<pre id="xmlDisplay"></pre>

<!--SCRIPT for when sending requests to the backend zap api -->
<script>
  function startScan(apiEndpoint) {
    //gets the target url from the input field
    var targetUrl = document.getElementById('targetUrl').value;
    //sends the target url to the backend which then sends it to zap api with the required content header and method type in json
    fetch(apiEndpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ url: targetUrl })
    })

      //gets response from backend
      .then(response => response.json())
      //gets output from backend and converts from json to string
      .then(data => document.getElementById('output').textContent = JSON.stringify(data, null, 2))
      //catches errors in console
      .catch(error => console.error('Error:', error));

  }
  //starts spider function when the button is clicked in our backend
  function startSpider() {
    startScan('/start_spider');
  }
  //starts active sscan in the backend when button clicked
  function startActiveScan() {
    startScan('/start_active_scan');
  }

  function viewScanStatus() {
    var scanId = document.getElementById('scanId').value;
    fetch('/get_scan_status', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ scanId: scanId })
    })
      .then(response => response.json())
      .then(data => {
        document.getElementById('scanStatusDisplay').textContent = 'Scan Status: ' + JSON.stringify(data, null, 2);
      })
      .catch(error => console.error('Error:', error));
  }

  
function generateXmlReport() {
    var scanId = document.getElementById('scanId').value;
    fetch('/generate_xml_report', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ scanId: scanId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            alert('XML Report Generated Successfully');
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => console.error('Error:', error));
}

function viewXmlReport() {
    var scanId = document.getElementById('scanId').value;
    if (!scanId) {
        alert("Please enter a scan ID.");
        return;
    }
    fetch(`/view_scan_result?scanId=${scanId}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert("Error: " + data.error);
            } else {
                document.getElementById('xmlDisplay').textContent = data.xml_report;
            }
        })
        .catch(error => console.error('Error:', error));
}


  
  



</script>
</div>
</div>
{% endblock %}